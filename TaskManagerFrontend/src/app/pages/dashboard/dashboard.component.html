<div class="container">
  <mat-card>
    <mat-card-title>Welcome, {{ currentUser?.username }}!</mat-card-title>
    <mat-card-content>
      <p>Your role: {{ currentUser?.role }}</p>

      <div *ngIf="loading" class="loading-spinner">
        <mat-spinner></mat-spinner>
        <p>Loading dashboard data...</p>
      </div>

      <div *ngIf="error" class="alert alert-danger">
        {{ error }}
      </div>

      <div *ngIf="!loading && !error" class="dashboard-content">
        <div class="stats-grid">
          <mat-card class="dashboard-card">
            <mat-card-header>
              <mat-card-title>Total Tasks</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <h3>{{ totalTasks }}</h3>
            </mat-card-content>
          </mat-card>
          
          <mat-card class="dashboard-card">
            <mat-card-header>
              <mat-card-title>Pending Tasks</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <h3>{{ pendingTasks }}</h3>
            </mat-card-content>
          </mat-card>
          
          <mat-card class="dashboard-card">
            <mat-card-header>
              <mat-card-title>In Progress</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <h3>{{ inProgressTasks }}</h3>
            </mat-card-content>
          </mat-card>
          
          <mat-card class="dashboard-card">
            <mat-card-header>
              <mat-card-title>Completed Tasks</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <h3>{{ completedTasks }}</h3>
            </mat-card-content>
          </mat-card>
          
          <mat-card class="dashboard-card" *ngIf="authService.isAdmin()">
            <mat-card-header>
              <mat-card-title>Total Users</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <h3>{{ totalUsers }}</h3>
            </mat-card-content>
          </mat-card>
        </div>

        <mat-card class="recent-tasks-card">
          <mat-card-title>Recent Tasks</mat-card-title>
          <mat-card-content>
            <div *ngIf="tasks.length === 0" class="no-tasks">
              <mat-icon>assignment</mat-icon>
              <p>No tasks found.</p>
            </div>
            <table mat-table [dataSource]="tasks.slice(0, 5)" class="mat-elevation-z8" *ngIf="tasks.length > 0">
              <ng-container matColumnDef="title">
                <th mat-header-cell *matHeaderCellDef>Title</th>
                <td mat-cell *matCellDef="let element">{{ element.title }}</td>
              </ng-container>

              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let element">
                  <span [class]="getStatusClass(element.status)">{{ element.status }}</span>
                </td>
              </ng-container>

              <ng-container matColumnDef="priority">
                <th mat-header-cell *matHeaderCellDef>Priority</th>
                <td mat-cell *matCellDef="let element">
                  <span [class]="getPriorityClass(element.priority)">{{ element.priority }}</span>
                </td>
              </ng-container>

              <ng-container matColumnDef="dueDate">
                <th mat-header-cell *matHeaderCellDef>Due Date</th>
                <td mat-cell *matCellDef="let element">{{ element.dueDate ? (element.dueDate | date:'shortDate') : 'N/A' }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-card-content>
  </mat-card>
</div>

